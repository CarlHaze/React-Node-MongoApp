(()=>{"use strict";var e={45:(e,t,a)=>{a.d(t,{Z:()=>m});const n=require("axios");var o=a.n(n),i=a(689),r=a.n(i),s=a(819),l=a.n(s);const c=require("@mui/icons-material"),m=function(e){const[t,a]=(0,i.useState)(!1),[n,s]=(0,i.useState)(""),[m,d]=(0,i.useState)(),[p,u]=(0,i.useState)("");return r().createElement("div",{className:"card"},r().createElement("div",{className:"our-card-top"},t&&r().createElement("div",{className:"our-custom-input"},r().createElement("div",{className:"our-custom-input-interior"},r().createElement("input",{onChange:e=>d(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),r().createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/defaultImage.png",className:"card-img-top",alt:`${e.species} named ${e.name}`})),r().createElement("div",{className:"card-body"},!t&&r().createElement(r().Fragment,null,r().createElement("h4",null,"Name: ",e.name),r().createElement("p",{className:"text-muted small"},"Species: ",e.species),!e.readOnly&&r().createElement(r().Fragment,null,r().createElement(l(),{variant:"contained",onClick:()=>{a(!0),s(e.name),u(e.species),d("")}},"Edit")," ",r().createElement(l(),{variant:"outlined",startIcon:r().createElement(c.Delete,null),color:"error",size:"small",onClick:async()=>{o().delete(`/animal/${e.id}`),e.setAnimals((t=>t.filter((t=>t._id!=e.id))))}},"Delete"))),t&&r().createElement("form",{onSubmit:async function(t){t.preventDefault(),a(!1),e.setAnimals((t=>t.map((function(t){return t._id==e.id?{...t,name:n,species:p}:t}))));const i=new FormData;m&&i.append("photo",m),i.append("_id",e.id),i.append("name",n),i.append("species",p);const r=await o().post("/update-animal",i,{headers:{"Content-Type":"multipart/form-data"}});r.data&&e.setAnimals((t=>t.map((function(t){return t._id==e.id?{...t,photo:r.data}:t}))))}},r().createElement("div",{className:"mb-1"},r().createElement("input",{autoFocus:!0,onChange:e=>s(e.target.value),type:"text",className:"form-control form-control-sm",value:n})),r().createElement("div",{className:"mb-2"},r().createElement("input",{onChange:e=>u(e.target.value),type:"text",className:"form-control form-control-sm",value:p})),r().createElement("button",{className:"btn btn-sm btn-success"},"Save")," ",r().createElement("button",{onClick:()=>a(!1),className:"btn btn-sm btn-outline-secondary"},"Cancel"))))}},819:e=>{e.exports=require("@mui/material/Button")},860:e=>{e.exports=require("express")},470:e=>{e.exports=require("fs-extra")},13:e=>{e.exports=require("mongodb")},738:e=>{e.exports=require("multer")},689:e=>{e.exports=require("react")},684:e=>{e.exports=require("react-dom/server")},109:e=>{e.exports=require("sanitize-html")},441:e=>{e.exports=require("sharp")},17:e=>{e.exports=require("path")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,a),i.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=a(819),t=a.n(e);const n=require("@mui/material/Typography");var o=a.n(n);const{response:i}=a(860),r=a(860),{MongoClient:s,ObjectId:l}=a(13),c=a(738)(),m=a(109),d=a(470),p=a(441);let u;const g=a(17),f=a(689),y=a(684),b=a(45).Z;d.ensureDirSync(g.join("public","uploaded-photos"));const h=r();function v(e,t,a){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.species&&(e.body.species=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:m(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),species:m(e.body.species.trim(),{allowedTags:[],allowedAttributes:{}})},a()}h.set("view engine","ejs"),h.set("views","./views"),h.use(r.static("public")),h.use(r.json()),h.use(r.urlencoded({extended:!1})),h.get("/",(async(e,a)=>{const n=await u.collection("animals").find().toArray(),i=y.renderToString(f.createElement("div",{className:"container"},!n.length&&f.createElement("p",null,"Admin needs to add some animals please comback later"),f.createElement(o(),{variant:"h1",component:"div",gutterBottom:!0,align:"center"},"MERN Application"),f.createElement("div",{className:"animal-grid mb-3"},n.map((e=>f.createElement(b,{key:e.id,name:e.name,species:e.species,photo:e.photo,id:e._id,readOnly:!0})))),f.createElement(t(),{variant:"contained",color:"success",size:"Large",href:"/admin",sx:{":hover":{bgcolour:"primary.main",color:"white"}}},"Login to manage animal cards")));a.render("home",{generatedHTML:i})})),h.use((function(e,t,a){t.set("WWW-Authenticate","Basic realm='MERN Pet App'"),"Basic YWRtaW46YWRtaW4="==e.headers.authorization?a():(console.log(e.headers.authorization),t.status(401).send("Try Again"))})),h.get("/admin",((e,t)=>{t.render("admin")})),h.get("/api/animals",(async(e,t)=>{const a=await u.collection("animals").find().toArray();t.json(a)})),h.post("/create-animal",c.single("photo"),v,(async(e,t)=>{if(e.file){const t=`${Date.now()}.jpg`;await p(e.file.buffer).resize(900,500).jpeg({quality:60}).toFile(g.join("public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const a=await u.collection("animals").insertOne(e.cleanData),n=await u.collection("animals").findOne({_id:new l(a.insertedId)});t.send(n)})),h.delete("/animal/:id",(async(e,t)=>{"string"!=typeof e.params.id&&(e.params.id="");const a=await u.collection("animals").findOne({_id:new l(e.params.id)});a.photo&&d.remove(g.join("public","uploaded-photos",a.photo)),u.collection("animals").deleteOne({_id:new l(e.params.id)}),t.send("All done")})),h.post("/update-animal",c.single("photo"),v,(async(e,t)=>{if(e.file){const a=`${Date.now()}.jpg`;await p(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(g.join("public","uploaded-photos",a)),e.cleanData.photo=a;const n=await u.collection("animals").findOneAndUpdate({_id:new l(e.body._id)},{$set:e.cleanData});n.value.photo&&d.remove(g.join("public","uploaded-photos",n.value.photo)),t.send(a)}else u.collection("animals").findOneAndUpdate({_id:new l(e.body._id)},{$set:e.cleanData}),t.send(!1)})),async function(){const e=new s("mongodb+srv://Carl_Ellis:mongodbtest@cluster0.j16jrhy.mongodb.net/MERN_App_DB?retryWrites=true&w=majority");await e.connect(),u=e.db(),h.listen(3e3)}()})()})();